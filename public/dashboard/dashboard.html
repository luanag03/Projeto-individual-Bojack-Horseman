<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bojack | Dashboards</title>

    <link rel="stylesheet" href="./../css/dashboards.css">
    <script src="../js/sessao.js"></script>

    <!-- scripts do Chart.js - 2022-1 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body onload="obterDadosLetras()">

    <header class="home">
        <div class="logo">
            <img src="../assets/icon/Logo_bojack.png" alt="Logo BoJack Horseman">
        </div>

        <div class="hello">
            <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
        </div>
        <nav class="nav-dash">
            <ul>
                <li><a href="./home.html">Home</a></li>
                <li><a href="./quiz.html">Quiz</a></li>
                <li><a href="./dashboard.html">Dashboard</a></li>
                <li><a href="./comunidade.html">Comunidade</a></li>
            </ul>
        </nav>

        <div class="sair">
            <a href="../index.html">
                <img src="../assets/icon/sair.png" alt="Ícone sair">
                Sair
            </a>
        </div>
    </header>

    <section class="dashboard-personagens">

        <div class="dashboard-container">
            <div class="dashboard-titulo">
                <h1>Dashboard</h1>
            </div>
            <div class="linha-topo">
                <div class="card-grafico">
                    <h2>Gráfico de Personagens</h2>
                    <canvas id="graficoLetras"></canvas>
                </div>

                <div class="card-kpi">
                    <h2>Seu Personagem</h2><br>
                    <div id="kpiPersonagem"></div>
                </div>

            </div>

            <div class="card-tabela">
                <h2>Tabela de Porcentagens</h2>
                <div id="tabelaLetras"></div>
            </div>

        </div>

    </section>

</body>
</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

      function obterDadosLetras() {
        const idUsuario = sessionStorage.ID_USUARIO;

        fetch(`/dash/relatorio/letras-ultima/${idUsuario}`)
            .then(res => res.json())
            .then(dados => {
                criarDashboardLetras(dados);
                criarTabelaLetras(dados);
                criarKpiPersonagem(dados);
            })
            .catch(err => console.error(err));
    }

     function criarDashboardLetras(respostas) {

        const ctx = document.getElementById("graficoLetras").getContext("2d");

        const personagens = {
            a: "Bojack Horseman",
            b: "Sarah Lynn",
            c: "Princess Carolyn",
            d: "Mr. Peanutbutter",
            e: "Diane",
            f: "Beatrice Horseman",
            g: "Hollyhock",
            h: "Todd Chavez"
        };

        const cores = {
            a: "#8B4513",
            b: "#FF00FF",
            c: "#EE82EE",
            d: "#FFFF00",
            e: "#191970",
            f: "#A52A2A",
            g: "#D4FF00",
            h: "#FF0000"
        };

        let total = 0;
        for (let i = 0; i < respostas.length; i++) {
            total += respostas[i].quantidade;
        }

        let labels = [];
        let valores = [];
        let background = [];

        for (let i = 0; i < respostas.length; i++) {
            let item = respostas[i];

            labels.push(personagens[item.letra]);
            valores.push(Number(((item.quantidade / total) * 100).toFixed(1)));
            background.push(cores[item.letra]);
        }

        new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: labels,
                datasets: [{
                    data: valores,
                    backgroundColor: background
                }]
            }
        });
    }


</script>