<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Bojack | quiz</title>
    <link rel="stylesheet" href="../css/style.css">
</head>


<body>

    <header class="home">
        <div class="logo">
            <img src="../assets/icon/Logo_bojack.png" alt="Logo BoJack Horseman">
        </div>

        <div class="hello">
            <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
        </div>
        <nav class="nav-dash">
            <ul>
                <li><a href="./home.html">Home</a></li>
                <li><a href="./quiz.html">Quiz</a></li>
                <li><a href="./dashboard.html">Dashboard</a></li>
                <li><a href="./comunidade.html">Comunidade</a></li>
            </ul>
        </nav>

        <div class="sair">
            <a href="../index.html">
                <img src="../assets/icon/sair.png" alt="Ícone sair">
                Sair
            </a>
        </div>
    </header>


    <section class="content-secion">
        <h1>Quiz Bojack Horseman</h1>
        <div class="quiz-box">
            <h2 style="margin-bottom: 32px;" id="quizTitulo">Descubra seu Personagem !</h2>
            <button onclick="iniciarQuiz()" id="startBtn">Começar Quiz</button>

            <div style="width: 100%;" id="quizContainer" class="esconder">
                <div id="perguntaTexto" class="pergunta"></div>
                <form onchange="habilitarBotao()" id="alternativasContainer"></form>
                <button onclick="irParaProximaPergunta()" id="btnProxima">Próxima</button>
            </div>

            <div id="resultado" class="esconder">
                <h3>Suas respostas:</h3>
                <ul id="respostasUsuario"></ul>

            </div>

            <a href="./dashboard.html" id="btnDashboard" class="botao-dashboard"
                style="display:none; margin-top: 15px;">Ver
                Dashboard</a>

        </div>
        </div>
    </section>

</body>

</html>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    let perguntas = [];
    let respostas = [];
    let indicePergunta = 0;
    const fkQuiz = 1;

    let idUltimaResposta = null;

    const startBtn = document.getElementById("startBtn");
    const quizBox = document.getElementById("quizContainer");
    const perguntaTexto = document.getElementById("perguntaTexto");
    const alternativasContainer = document.getElementById("alternativasContainer");
    const proximaBtn = document.getElementById("btnProxima");
    const resultadoBox = document.getElementById("resultado");
    const listaRespostas = document.getElementById("respostasUsuario");
    proximaBtn.disabled = true;

    function habilitarBotao() {
        proximaBtn.disabled = false;
    };

    function iniciarQuiz() {
        fetch(`/quiz/buscarQuiz/${fkQuiz}`)
            .then(function (res) {

                res.json().then(data => {

                    const perguntasID = {};

                    for (let i = 0; i < data.length; i++) {
                        const item = data[i];

                        if (!perguntasID[item.pergunta_id]) {
                            perguntasID[item.pergunta_id] = {
                                texto: item.pergunta_texto,
                                alternativas: []
                            };
                        }

                        perguntasID[item.pergunta_id].alternativas.push({
                            letra: item.alternativa_letra,
                            texto: item.alternativa_texto
                        });
                    }

                    perguntas = Object.values(perguntasID);
                    respostas = [];
                    indicePergunta = 0;

                    startBtn.style.display = "none";
                    quizBox.classList.remove("esconder");
                    mostrarPergunta();
                })
            })
    }

    function mostrarPergunta() {
        const pergunta = perguntas[indicePergunta];
        perguntaTexto.textContent = pergunta.texto;
        alternativasContainer.innerHTML = "";
        proximaBtn.disabled = true;

        for (let i = 0; i < pergunta.alternativas.length; i++) {
            const alt = pergunta.alternativas[i];

            const id = `pergunta${indicePergunta}_alt${i}`;

            alternativasContainer.innerHTML += `
    <label class="alternativa">
      <input type="radio" name="alternativa" value="${alt.letra}">
      ${alt.letra}) ${alt.texto}
    </label> `;
        }

    }


</script>